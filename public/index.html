<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>agentic-lite ‚Äî Demo</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #0a0a0a; color: #e0e0e0;
      min-height: 100vh; display: flex; flex-direction: column; align-items: center;
      padding: 40px 20px;
    }
    h1 { font-size: 28px; font-weight: 600; margin-bottom: 6px; }
    h1 span { color: #fbbf24; }
    .subtitle { color: #888; font-size: 14px; margin-bottom: 32px; }
    .container { width: 100%; max-width: 640px; }
    .config-section { margin-bottom: 24px; }
    .config-row { display: flex; gap: 8px; margin-bottom: 8px; }
    label { font-size: 12px; color: #888; display: block; margin-bottom: 4px; }
    input, select, textarea {
      background: #1a1a1a; border: 1px solid #333; border-radius: 8px;
      color: #e0e0e0; padding: 10px 12px; font-size: 14px; width: 100%;
      outline: none; transition: border-color 0.2s;
    }
    input:focus, select:focus, textarea:focus { border-color: #fbbf24; }
    textarea { resize: vertical; min-height: 80px; font-family: inherit; }
    .tools-row { display: flex; gap: 12px; margin-bottom: 16px; }
    .tool-chip {
      padding: 6px 14px; border-radius: 20px; font-size: 13px; cursor: pointer;
      border: 1px solid #333; background: #1a1a1a; transition: all 0.2s;
    }
    .tool-chip.active { background: #fbbf2420; border-color: #fbbf24; color: #fbbf24; }
    button.run {
      width: 100%; padding: 12px; border: none; border-radius: 8px;
      background: #fbbf24; color: #0a0a0a; font-size: 15px; font-weight: 600;
      cursor: pointer; transition: opacity 0.2s;
    }
    button.run:hover { opacity: 0.9; }
    button.run:disabled { opacity: 0.4; cursor: not-allowed; }
    .result { margin-top: 24px; }
    .result-card {
      background: #1a1a1a; border: 1px solid #333; border-radius: 12px;
      padding: 16px; margin-bottom: 12px;
    }
    .result-label { font-size: 11px; color: #888; text-transform: uppercase; margin-bottom: 8px; }
    .result-text { font-size: 14px; line-height: 1.6; white-space: pre-wrap; }
    .sources a { color: #fbbf24; text-decoration: none; font-size: 13px; }
    .sources a:hover { text-decoration: underline; }
    .meta { font-size: 12px; color: #666; margin-top: 8px; }
    .error { color: #ef4444; }
    .loading { text-align: center; color: #888; padding: 20px; }
    .collapsible { cursor: pointer; }
    .collapsible::before { content: '‚ñ∏ '; }
    .collapsible.open::before { content: '‚ñæ '; }
    pre { background: #111; padding: 12px; border-radius: 6px; overflow-x: auto; font-size: 12px; margin-top: 8px; }
  </style>
</head>
<body>
  <h1><span>‚ö°</span> agentic-lite</h1>
  <p class="subtitle">One function call. Built-in search, code execution, file processing.</p>

  <div class="container">
    <div class="config-section">
      <div class="config-row">
        <div style="flex:1">
          <label>Provider</label>
          <select id="provider">
            <option value="anthropic">Anthropic</option>
            <option value="openai">OpenAI</option>
            <option value="custom">Custom</option>
          </select>
        </div>
        <div style="flex:2">
          <label>API Key</label>
          <input type="password" id="apiKey" placeholder="sk-ant-... or sk-...">
        </div>
      </div>
      <div class="config-row">
        <div style="flex:1">
          <label>Base URL <span style="color:#555">(optional, for proxies)</span></label>
          <input id="baseUrl" placeholder="https://api.anthropic.com">
        </div>
        <div style="flex:1">
          <label>Model <span style="color:#555">(optional)</span></label>
          <input id="model" placeholder="claude-sonnet-4-20250514">
        </div>
      </div>
    </div>

    <label>Tools</label>
    <div class="tools-row">
      <div class="tool-chip active" data-tool="search">üîç Search</div>
      <div class="tool-chip active" data-tool="code">üíª Code</div>
      <div class="tool-chip" data-tool="file">üìÅ File</div>
    </div>

    <label>Prompt</label>
    <textarea id="prompt" placeholder="Ask anything..."></textarea>

    <button class="run" id="runBtn" style="margin-top:12px">Run</button>

    <div class="result" id="result"></div>
  </div>

  <script>
    // Tool chips toggle
    document.querySelectorAll('.tool-chip').forEach(chip => {
      chip.addEventListener('click', () => chip.classList.toggle('active'))
    })

    // Run button
    document.getElementById('runBtn').addEventListener('click', async () => {
      const btn = document.getElementById('runBtn')
      const resultDiv = document.getElementById('result')
      const prompt = document.getElementById('prompt').value.trim()
      const apiKey = document.getElementById('apiKey').value.trim()

      if (!prompt) return alert('Enter a prompt')
      if (!apiKey) return alert('Enter an API key')

      const tools = [...document.querySelectorAll('.tool-chip.active')].map(c => c.dataset.tool)
      const provider = document.getElementById('provider').value
      const baseUrl = document.getElementById('baseUrl').value.trim() || undefined
      const model = document.getElementById('model').value.trim() || undefined

      btn.disabled = true
      btn.textContent = 'Running...'
      resultDiv.innerHTML = '<div class="loading">‚è≥ Thinking...</div>'

      try {
        const res = await fetch('/api/ask', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ prompt, tools, provider, baseUrl, apiKey, model }),
        })
        const data = await res.json()
        if (!res.ok) throw new Error(data.error || 'Request failed')
        renderResult(data)
      } catch (err) {
        resultDiv.innerHTML = `<div class="result-card"><div class="error">${err.message}</div></div>`
      } finally {
        btn.disabled = false
        btn.textContent = 'Run'
      }
    })

    function renderResult(data) {
      const el = document.getElementById('result')
      let html = ''

      // Answer
      html += `<div class="result-card">
        <div class="result-label">Answer</div>
        <div class="result-text">${escapeHtml(data.answer || '(no answer)')}</div>
        ${data.usage ? `<div class="meta">${data.usage.input} input / ${data.usage.output} output tokens</div>` : ''}
      </div>`

      // Sources
      if (data.sources?.length) {
        html += `<div class="result-card sources">
          <div class="result-label">Sources (${data.sources.length})</div>
          ${data.sources.map(s => `<div><a href="${s.url}" target="_blank">${escapeHtml(s.title)}</a>
            ${s.snippet ? `<div style="color:#888;font-size:12px;margin:2px 0 8px">${escapeHtml(s.snippet.slice(0,120))}...</div>` : ''}
          </div>`).join('')}
        </div>`
      }

      // Code results
      if (data.codeResults?.length) {
        html += `<div class="result-card">
          <div class="result-label">Code Execution (${data.codeResults.length})</div>
          ${data.codeResults.map(c => `<pre>${escapeHtml(c.code)}</pre>
            <div style="color:#4ade80;font-size:13px;margin-top:4px">‚Üí ${escapeHtml(c.output || c.error || '')}</div>
          `).join('')}
        </div>`
      }

      // Tool calls
      if (data.toolCalls?.length) {
        html += `<div class="result-card">
          <div class="result-label collapsible" onclick="this.classList.toggle('open');this.nextElementSibling.style.display=this.classList.contains('open')?'block':'none'">
            Tool Calls (${data.toolCalls.length})
          </div>
          <pre style="display:none">${escapeHtml(JSON.stringify(data.toolCalls, null, 2))}</pre>
        </div>`
      }

      el.innerHTML = html
    }

    function escapeHtml(s) {
      return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
    }
  </script>
</body>
</html>